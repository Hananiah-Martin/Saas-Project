<% if current_user %>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
              <div>
                <p class="text-muted mb-1 text-uppercase small fw-medium">Workspace</p>
                <div class="d-flex align-items-center">
                  <i class="bi bi-building text-primary me-2 fs-4"></i>
                  <h2 class="h4 fw-bold mb-0 text-dark">
                    <%= current_tenant.name %>
                  </h2>
                  <span class="badge bg-light text-primary border ms-3">
                    <%= current_tenant.plan.capitalize %> Plan
                  </span>
                </div>
              </div>

              <div>
                <%# Logic: Show button if plan is premium OR if free plan has 0 projects %>
                <% if current_tenant.plan == 'premium' || current_tenant.projects.count < 1 %>
                  <%= link_to new_project_path, class: "btn btn-primary d-flex align-items-center gap-2" do %>
                    <i class="bi bi-plus-lg"></i>
                    <span>New Project</span>
                  <% end %>
                <% else %>
                  <%# Optional: Show a disabled button or Upgrade link when limit is reached %>
                  <%= link_to checkout_path, class: "btn btn-outline-warning d-flex align-items-center gap-2" do %>
                    <i class="bi bi-rocket-takeoff-fill"></i>
                    <span>Limit Reached (Upgrade to Premium)</span>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <h4 class="fw-bold mb-4 d-flex align-items-center">
              <i class="bi bi-collection-fill me-2 text-secondary"></i>
              Active Projects
            </h4>

            <div id="projects_list">
              <% if @projects.any? %>
                <div class="row row-cols-1 row-cols-md-2 g-4">
                  <% @projects.each do |project| %>
                    <div class="col">
                      <%# This renders your _project.html.erb partial %>
                      <%= render project %>
                    </div>
                  <% end %>
                </div>
              <% else %>
                <div class="card border-dashed bg-light text-center py-5">
                  <div class="card-body">
                    <i class="bi bi-folder2-open display-4 text-muted mb-3"></i>
                    <h5>No projects found</h5>
                    <p class="text-muted">Get started by creating your first project for <%= current_tenant.name %>.</p>
                    <%= link_to "Create Project", new_project_path, class: "btn btn-outline-primary mt-2" %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<% else %>
  <!-- Hero Section -->
  <div class="bg-gradient-primary-to-secondary py-5 mb-5">
    <div class="container px-4 py-5">
      <div class="row align-items-center justify-content-center text-center">
        <div class="col-lg-8">
          <div class="mb-4">
            <i class="bi bi-kanban fs-1 text-white mb-3 d-block"></i>
          </div>
          <h1 class="display-4 fw-bold text-white mb-4">
            Welcome to Project Management App
          </h1>
          <p class="lead text-white-50 mb-4 fs-4">
            Streamline your workflow and manage your projects effortlessly with our modern SaaS platform. 
            Choose a plan that fits your needs below.
          </p>
          <div class="d-flex gap-3 justify-content-center">
            <a href="#pricing" class="btn btn-light btn-lg px-4 shadow-sm">
              View Plans
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pricing Section -->
  <div id="pricing" class="container mb-5 pb-5">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h2 class="display-5 fw-bold mb-3">Choose Your Plan</h2>
        <p class="text-muted fs-5">Start for free, upgrade when you need more power</p>
      </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 g-4 justify-content-center">
      
      <!-- Free Plan -->
      <div class="col-lg-5">
        <div class="card h-100 border-0 shadow-hover rounded-4 overflow-hidden transition-all">
          <div class="card-header py-4 text-white bg-primary border-0 position-relative">
            <div class="text-center">
              <h3 class="my-0 fw-bold">Free Plan</h3>
              <p class="mb-0 mt-2 opacity-75 small">Perfect for getting started</p>
            </div>
          </div>
          
          <div class="card-body p-4 d-flex flex-column">
            <div class="text-center mb-4 pb-3 border-bottom">
              <div class="d-flex align-items-center justify-content-center">
                <h1 class="display-4 fw-bold mb-0">$0</h1>
                <span class="text-muted fs-5 ms-2">/month</span>
              </div>
              <p class="text-muted small mb-0 mt-2">No credit card required</p>
            </div>
            
            <ul class="list-unstyled mb-4 flex-grow-1">
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">Unlimited file uploads</span>
              </li>
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">Responsive design</span>
              </li>
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">Access anywhere</span>
              </li>
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-dash-circle text-warning me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">1 Project only</span>
              </li>
            </ul>
            
            <div class="mt-auto">
              <%= link_to new_user_registration_path(plan: 'free'), class: 'btn btn-outline-primary btn-lg w-100 rounded-3 fw-semibold' do %>
                <i class="bi bi-rocket-takeoff me-2"></i>
                Sign Up for Free
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Premium Plan -->
      <div class="col-lg-5">
        <div class="card h-100 border-0 shadow-lg rounded-4 overflow-hidden transition-all position-relative">
          <!-- Popular Badge -->
          <div class="position-absolute top-0 end-0 bg-warning text-dark px-3 py-1 rounded-start-3 fw-bold small" style="margin-top: 1rem; z-index: 10;">
            <i class="bi bi-star-fill me-1"></i>
            POPULAR
          </div>
          
          <div class="card-header py-4 text-white bg-gradient-success border-0">
            <div class="text-center">
              <h3 class="my-0 fw-bold">Premium Plan</h3>
              <p class="mb-0 mt-2 opacity-75 small">For growing teams and businesses</p>
            </div>
          </div>
          
          <div class="card-body p-4 d-flex flex-column">
            <div class="text-center mb-4 pb-3 border-bottom">
              <div class="d-flex align-items-center justify-content-center">
                <h1 class="display-4 fw-bold mb-0 text-success">$10</h1>
                <span class="text-muted fs-5 ms-2">/month</span>
              </div>
              <p class="text-muted small mb-0 mt-2">Billed monthly, cancel anytime</p>
            </div>
            
            <ul class="list-unstyled mb-4 flex-grow-1">
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">Unlimited file uploads</span>
              </li>
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">Responsive design</span>
              </li>
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-check-circle-fill text-success me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark">Access anywhere</span>
              </li>
              <li class="mb-3 d-flex align-items-start">
                <i class="bi bi-star-fill text-warning me-3 fs-5 flex-shrink-0"></i>
                <span class="text-dark fw-bold">Unlimited Projects</span>
              </li>
            </ul>
            
            <div class="mt-auto">
              <%= link_to new_user_registration_path(plan: 'premium'), class: 'btn btn-success btn-lg w-100 rounded-3 fw-semibold shadow-sm' do %>
                <i class="bi bi-gem me-2"></i>
                Get Premium
              <% end %>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <style>
    .bg-gradient-primary-to-secondary {
      background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    }
    
    .bg-gradient-success {
      background: linear-gradient(135deg, #198754 0%, #146c43 100%);
    }
    
    .letter-spacing-1 {
      letter-spacing: 1px;
    }
    
    .shadow-hover {
      transition: all 0.3s ease;
    }
    
    .shadow-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 1rem 3rem rgba(0,0,0,.175) !important;
    }
    
    .transition-all {
      transition: all 0.3s ease;
    }
  </style>
<% end %>